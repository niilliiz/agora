import styles from "./media-controller.module.css";
import { useState } from "react";
import PermissionInstructionModal from "@/app/components/preview/components/permission-instruction-modal";

function MediaController({
  className = "",
  isJoined = false,
  micOn,
  cameraOn,
  setMicOn,
  setCameraOn,
  onLeave,
  onVolumeChange,
  onOpenMoreInfo,
  onOpenNotepad,
  permissionState,
  openPendingPermissionModal,
}) {
  const [openPermissionInstructionModal, setOpenPermissionInstructionModal] = useState(false);
  // if permissionState === 'granted' => just disable of enable the camera and mic...
  //if permissionState ==='rejected' => open instruction modal

  function handleSwitchCameraState() {
    if (isJoined || permissionState === "granted") {
      setCameraOn();
    } else {
      openPendingPermissionModal && openPendingPermissionModal();
    }
  }
  function handleSwitchMicState() {
    if (isJoined || permissionState === "granted") {
      setMicOn();
    } else {
      openPendingPermissionModal && openPendingPermissionModal();
    }
  }

  const cameraIcon = cameraOn ? (
    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18" fill="none">
      <path
        d="M17.7026 5.13281C17.6129 5.08473 17.5118 5.06189 17.4102 5.06672C17.3085 5.07155 17.2101 5.10387 17.1253 5.16023L14.625 6.82383V5.0625C14.625 4.76413 14.5065 4.47798 14.2955 4.267C14.0845 4.05603 13.7984 3.9375 13.5 3.9375H2.25C1.95163 3.9375 1.66548 4.05603 1.4545 4.267C1.24353 4.47798 1.125 4.76413 1.125 5.0625V12.9375C1.125 13.2359 1.24353 13.522 1.4545 13.733C1.66548 13.944 1.95163 14.0625 2.25 14.0625H13.5C13.7984 14.0625 14.0845 13.944 14.2955 13.733C14.5065 13.522 14.625 13.2359 14.625 12.9375V11.1797L17.1253 12.8468C17.2182 12.9071 17.3268 12.9387 17.4375 12.9375C17.5867 12.9375 17.7298 12.8782 17.8352 12.7727C17.9407 12.6673 18 12.5242 18 12.375V5.625C17.9993 5.52379 17.9713 5.42465 17.9189 5.33803C17.8666 5.2514 17.7918 5.18051 17.7026 5.13281ZM13.5 12.9375H2.25V5.0625H13.5V12.9375ZM16.875 11.3238L14.625 9.82406V8.17594L16.875 6.67969V11.3238Z"
        fill="white"
      />
    </svg>
  ) : (
    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18" fill="none">
      <path
        d="M17.7026 5.1328C17.6129 5.08472 17.5118 5.06188 17.4102 5.06671C17.3085 5.07154 17.2101 5.10386 17.1253 5.16022L14.625 6.82381V5.06249C14.625 4.76412 14.5065 4.47797 14.2955 4.26699C14.0845 4.05601 13.7984 3.93749 13.5 3.93749H7.94953C7.80035 3.93749 7.65727 3.99675 7.55178 4.10224C7.44629 4.20773 7.38703 4.3508 7.38703 4.49999C7.38703 4.64917 7.44629 4.79224 7.55178 4.89773C7.65727 5.00322 7.80035 5.06249 7.94953 5.06249H13.5V11.224C13.5 11.3732 13.5593 11.5162 13.6648 11.6217C13.7702 11.7272 13.9133 11.7865 14.0625 11.7865C14.2117 11.7865 14.3548 11.7272 14.4602 11.6217C14.5657 11.5162 14.625 11.3732 14.625 11.224V11.1797L17.1253 12.8468C17.2182 12.9071 17.3268 12.9386 17.4375 12.9375C17.5867 12.9375 17.7298 12.8782 17.8352 12.7727C17.9407 12.6672 18 12.5242 18 12.375V5.62499C17.9993 5.52378 17.9713 5.42464 17.9189 5.33801C17.8666 5.25139 17.7918 5.18049 17.7026 5.1328ZM16.875 11.3238L14.625 9.82405V8.17592L16.875 6.67967V11.3238ZM3.79125 2.4342C3.74185 2.37852 3.68189 2.3332 3.61485 2.30086C3.54781 2.26852 3.47501 2.24981 3.40068 2.24581C3.32635 2.24181 3.25197 2.2526 3.18184 2.27756C3.11172 2.30252 3.04724 2.34115 2.99216 2.39122C2.93707 2.44128 2.89247 2.50177 2.86093 2.5692C2.8294 2.63663 2.81156 2.70964 2.80845 2.78401C2.80535 2.85839 2.81703 2.93263 2.84283 3.00246C2.86863 3.07228 2.90803 3.13629 2.95875 3.19077L3.63727 3.93749H2.25C1.95163 3.93749 1.66548 4.05601 1.4545 4.26699C1.24353 4.47797 1.125 4.76412 1.125 5.06249V12.9375C1.125 13.2359 1.24353 13.522 1.4545 13.733C1.66548 13.944 1.95163 14.0625 2.25 14.0625H12.8419L14.2087 15.5658C14.2581 15.6215 14.3181 15.6668 14.3852 15.6991C14.4522 15.7315 14.525 15.7502 14.5993 15.7542C14.6736 15.7582 14.748 15.7474 14.8182 15.7224C14.8883 15.6975 14.9528 15.6588 15.0078 15.6088C15.0629 15.5587 15.1075 15.4982 15.1391 15.4308C15.1706 15.3633 15.1884 15.2903 15.1915 15.216C15.1947 15.1416 15.183 15.0673 15.1572 14.9975C15.1314 14.9277 15.092 14.8637 15.0413 14.8092L3.79125 2.4342ZM2.25 12.9375V5.06249H4.66031L11.8195 12.9375H2.25Z"
        fill="white"
      />
    </svg>
  );

  const micIcon = micOn ? (
    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18" fill="none">
      <path
        d="M9 12.375C9.89482 12.3741 10.7527 12.0182 11.3855 11.3855C12.0182 10.7527 12.3741 9.89482 12.375 9V4.5C12.375 3.60489 12.0194 2.74645 11.3865 2.11351C10.7536 1.48058 9.89511 1.125 9 1.125C8.10489 1.125 7.24645 1.48058 6.61351 2.11351C5.98058 2.74645 5.625 3.60489 5.625 4.5V9C5.62593 9.89482 5.98181 10.7527 6.61454 11.3855C7.24728 12.0182 8.10518 12.3741 9 12.375ZM6.75 4.5C6.75 3.90326 6.98705 3.33097 7.40901 2.90901C7.83097 2.48705 8.40326 2.25 9 2.25C9.59674 2.25 10.169 2.48705 10.591 2.90901C11.0129 3.33097 11.25 3.90326 11.25 4.5V9C11.25 9.59674 11.0129 10.169 10.591 10.591C10.169 11.0129 9.59674 11.25 9 11.25C8.40326 11.25 7.83097 11.0129 7.40901 10.591C6.98705 10.169 6.75 9.59674 6.75 9V4.5ZM9.5625 14.5969V16.3125C9.5625 16.4617 9.50324 16.6048 9.39775 16.7102C9.29226 16.8157 9.14918 16.875 9 16.875C8.85082 16.875 8.70774 16.8157 8.60225 16.7102C8.49676 16.6048 8.4375 16.4617 8.4375 16.3125V14.5969C7.05069 14.4558 5.76546 13.8054 4.83036 12.7716C3.89526 11.7378 3.37671 10.394 3.375 9C3.375 8.85082 3.43426 8.70774 3.53975 8.60225C3.64524 8.49676 3.78832 8.4375 3.9375 8.4375C4.08668 8.4375 4.22976 8.49676 4.33525 8.60225C4.44074 8.70774 4.5 8.85082 4.5 9C4.5 10.1935 4.97411 11.3381 5.81802 12.182C6.66193 13.0259 7.80653 13.5 9 13.5C10.1935 13.5 11.3381 13.0259 12.182 12.182C13.0259 11.3381 13.5 10.1935 13.5 9C13.5 8.85082 13.5593 8.70774 13.6648 8.60225C13.7702 8.49676 13.9133 8.4375 14.0625 8.4375C14.2117 8.4375 14.3548 8.49676 14.4602 8.60225C14.5657 8.70774 14.625 8.85082 14.625 9C14.6233 10.394 14.1047 11.7378 13.1696 12.7716C12.2345 13.8054 10.9493 14.4558 9.5625 14.5969Z"
        fill="white"
      />
    </svg>
  ) : (
    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18" fill="none">
      <path
        d="M15.0411 14.8092L3.79115 2.43422C3.74175 2.37853 3.68179 2.33321 3.61475 2.30087C3.5477 2.26853 3.47491 2.24982 3.40058 2.24582C3.32625 2.24182 3.25187 2.25261 3.18174 2.27757C3.11161 2.30253 3.04714 2.34116 2.99205 2.39123C2.93697 2.44129 2.89236 2.50179 2.86083 2.56921C2.8293 2.63664 2.81146 2.70965 2.80835 2.78403C2.80524 2.8584 2.81693 2.93264 2.84273 3.00247C2.86853 3.07229 2.90793 3.1363 2.95865 3.19078L5.6249 6.12351V9C5.62498 9.60573 5.78808 10.2003 6.09708 10.7213C6.40609 11.2423 6.84962 11.6705 7.38113 11.961C7.91265 12.2515 8.51255 12.3937 9.11792 12.3725C9.72328 12.3513 10.3118 12.1676 10.8217 11.8406L11.5867 12.6844C10.9124 13.158 10.1211 13.4375 9.29888 13.4922C8.47669 13.547 7.65525 13.3749 6.92415 12.9948C6.19304 12.6147 5.58033 12.0412 5.15284 11.3368C4.72536 10.6323 4.4995 9.82401 4.4999 9C4.4999 8.85081 4.44063 8.70774 4.33514 8.60225C4.22966 8.49676 4.08658 8.4375 3.9374 8.4375C3.78821 8.4375 3.64514 8.49676 3.53965 8.60225C3.43416 8.70774 3.3749 8.85081 3.3749 9C3.37661 10.394 3.89515 11.7378 4.83026 12.7716C5.76536 13.8054 7.05058 14.4558 8.4374 14.5969V16.3125C8.4374 16.4617 8.49666 16.6048 8.60215 16.7102C8.70764 16.8157 8.85071 16.875 8.9999 16.875C9.14908 16.875 9.29216 16.8157 9.39765 16.7102C9.50313 16.6048 9.5624 16.4617 9.5624 16.3125V14.5962C10.5712 14.4958 11.534 14.1238 12.3482 13.5197L14.2086 15.5658C14.258 15.6215 14.318 15.6668 14.385 15.6991C14.4521 15.7315 14.5249 15.7502 14.5992 15.7542C14.6735 15.7582 14.7479 15.7474 14.8181 15.7224C14.8882 15.6975 14.9527 15.6588 15.0077 15.6088C15.0628 15.5587 15.1074 15.4982 15.139 15.4308C15.1705 15.3634 15.1883 15.2903 15.1914 15.216C15.1946 15.1416 15.1829 15.0674 15.1571 14.9975C15.1313 14.9277 15.0919 14.8637 15.0411 14.8092ZM8.9999 11.25C8.40316 11.25 7.83086 11.0129 7.40891 10.591C6.98695 10.169 6.7499 9.59674 6.7499 9V7.36101L10.049 10.9905C9.72554 11.161 9.36547 11.25 8.9999 11.25ZM6.12833 2.72672C6.51421 2.10187 7.09336 1.61994 7.77793 1.35405C8.46249 1.08815 9.2151 1.0528 9.92158 1.25335C10.6281 1.45391 11.2498 1.87942 11.6926 2.46534C12.1353 3.05126 12.3749 3.76561 12.3749 4.5V8.74898C12.3749 8.89817 12.3156 9.04124 12.2101 9.14673C12.1047 9.25222 11.9616 9.31148 11.8124 9.31148C11.6632 9.31148 11.5201 9.25222 11.4146 9.14673C11.3092 9.04124 11.2499 8.89817 11.2499 8.74898V4.5C11.2502 4.01014 11.0906 3.53358 10.7953 3.14269C10.5001 2.7518 10.0854 2.46793 9.61411 2.33421C9.14286 2.20049 8.64084 2.22421 8.1843 2.40178C7.72776 2.57935 7.34164 2.90105 7.08458 3.31804C7.04713 3.38362 6.99685 3.44099 6.93675 3.48672C6.87665 3.53245 6.80796 3.56561 6.73477 3.58423C6.66158 3.60284 6.58539 3.60652 6.51074 3.59506C6.43609 3.5836 6.36452 3.55722 6.30029 3.5175C6.23606 3.47778 6.18048 3.42553 6.13687 3.36387C6.09327 3.30221 6.06253 3.2324 6.04648 3.1586C6.03043 3.0848 6.02941 3.00853 6.04347 2.93433C6.05754 2.86013 6.0864 2.78952 6.12833 2.72672ZM13.1933 10.6362C13.3968 10.1147 13.5008 9.55975 13.4999 9C13.4999 8.85081 13.5592 8.70774 13.6646 8.60225C13.7701 8.49676 13.9132 8.4375 14.0624 8.4375C14.2116 8.4375 14.3547 8.49676 14.4601 8.60225C14.5656 8.70774 14.6249 8.85081 14.6249 9C14.6259 9.6998 14.4957 10.3936 14.241 11.0454C14.2152 11.1157 14.1757 11.1802 14.1247 11.235C14.0737 11.2899 14.0123 11.334 13.9441 11.3648C13.8758 11.3956 13.8021 11.4124 13.7272 11.4143C13.6524 11.4162 13.5779 11.4032 13.5081 11.376C13.4384 11.3487 13.3748 11.3078 13.321 11.2557C13.2673 11.2035 13.2245 11.1412 13.1952 11.0722C13.1659 11.0033 13.1506 10.9293 13.1503 10.8544C13.15 10.7795 13.1646 10.7053 13.1933 10.6362Z"
        fill="white"
      />
    </svg>
  );
  return (
    <div className={`${styles.mediaControllerContainer} ${className}`}>
      {onOpenNotepad && (
        <button className={styles.controller} onClick={() => onOpenNotepad()}>
          notepad
        </button>
      )}
      {onOpenMoreInfo && (
        <button className={styles.controller} onClick={() => onOpenMoreInfo()}>
          option
        </button>
      )}
      <button
        className={`${styles.controller} ${micOn ? styles.enable : styles.disable}`}
        onClick={handleSwitchMicState}
      >
        {micIcon}
      </button>
      <button
        className={`${styles.controller} ${cameraOn ? styles.enable : styles.disable}`}
        onClick={handleSwitchCameraState}
      >
        {cameraIcon}
      </button>
      {onVolumeChange && (
        <button className={styles.controller} onClick={() => onVolumeChange()}>
          volume
        </button>
      )}
      {onLeave && (
        <button className={styles.controller} onClick={() => onLeave()}>
          LEAVE
        </button>
      )}
      {openPermissionInstructionModal && <PermissionInstructionModal />}
    </div>
  );
}

export default MediaController;
